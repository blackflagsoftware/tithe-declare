import{d as z,Q as G,r as a,P as Q,k as E,o as W,x as s,z as t,R as p,K as c,S as M,O as n,T as b,M as w,N as O,L as g,A as u,n as X,y as r}from"./xhd2mIWo.js";import{a as Z}from"./CWfRAUh6.js";const ee={class:"flex flex-col items-center h-full"},te={class:"flex flex-row flex-wrap justify-center gap-4"},le={class:"flex flex-col"},oe=["value"],ne={class:"flex flex-col"},ae=["disabled"],se=["value"],re={key:0,class:"mt-5 p-4 text-white rounded w-full max-w-md"},de={class:"mb-4"},ie={class:"mb-4"},ue=["disabled"],me={key:1,class:"mt-5 p-4 border border-gray-500 bg-gray-100 text-gray-700 rounded"},ce={key:0,class:"mt-5 p-4 border border-red-500 bg-red-100 text-red-700 rounded"},be={class:"flex flex-row"},ve={class:"flex flex-col"},fe={class:"flex flex-col ml-4"},pe={class:"flex flex-col ml-4"},ye={class:"flex flex-row justify-between"},ge={class:"flex flex-row gap-4"},he={class:"font-bold mr-2"},xe={key:0},ke={key:1},we={key:2},Se=["onClick"],Ce={class:"mt-4"},_e={key:0},Te={class:"list-disc list-inside"},Ne=z({__name:"index",setup(Ee){const $=G(),d=a(""),i=a(""),P=a(new Array),D=a(new Array),S=a({}),{getAuthHeader:v}=Q(),f=Z(),C=a(""),_=a(""),T=a(""),h=a(!1),A=a(!1),y=a(""),x=a(""),U=a(""),V=a(""),R=a([]),m=a(""),k=a([]);function N(){f("/td-date/current-days",{method:"GET",headers:v()}).then(o=>{if(S.value=o.data,P.value=Object.keys(S.value),d.value!==""){const e=S.value[d.value]||[];D.value=e}}).catch(o=>{console.error("Error fetching current days:",o)})}function F(){const o=S.value[d.value]||[];D.value=o,i.value="",h.value=!1}function j(){const o=JSON.stringify({date:d.value,time:i.value});f("/td-date/check-hold-time",{method:"POST",body:o,headers:v()}).then(()=>{h.value=!0}).catch(e=>{e.response&&e.response.status===423?alert("This time is already held. Please select another time."):console.error("Error checking hold time:",e),i.value="",N()})}function B(){const o=JSON.stringify({date:d.value,time:i.value,name:y.value,email:x.value,phone:U.value});f("/td-date/confirm",{method:"POST",body:o,headers:v()}).then(()=>{V.value=`Your declaration date/time: ${J(d.value)} ${i.value}. You will receive a reminder if you provided an email.`,d.value="",i.value="",y.value="",x.value="",U.value="",h.value=!1,A.value=!0,N()}).catch(e=>{console.error("Error confirming date and time:",e)})}function J(o){const e={year:"numeric",month:"long",day:"numeric"},l=new Date(o);return l.setUTCHours(12),l.toLocaleDateString(void 0,e)}const I=E(()=>d.value==="");E(()=>!h.value);const H=E(()=>y.value===""),L=E(()=>$.query.admin===X().public.adminPwd);function K(){f("/td-date/block",{method:"POST",headers:{...v()},body:JSON.stringify({new_date:C.value,start_time:_.value,end_time:T.value})}).catch(o=>{console.error("Error adding date:",o)})}function Y(o){alert(`Pretend sending reminder for id ${o}`)}function q(){if(m.value===""){alert("Please enter an email address");return}f("/email-reminder",{method:"POST",headers:{...v()},body:JSON.stringify({email:m.value})}).then(()=>{k.value.includes(m.value)||k.value.push(m.value),m.value=""}).catch(o=>{console.error("Error adding email reminder:",o)})}return W(()=>{if(N(),L.value){const o=JSON.stringify({search:{filters:[{column:"date_value",compare:">",value:new Date().toISOString()},{column:"confirm",compare:"NOT NULL",value:""}]}});f("/td-date/search",{method:"POST",body:o,headers:v()}).then(e=>{R.value=e.data}).catch(e=>{console.error("Error fetching upcoming declarations:",e)}),f("/email-reminder/search",{method:"POST",body:{},headers:v()}).then(e=>{k.value=e.data.map(l=>l.email)}).catch(e=>{console.error("Error fetching known emails:",e)})}}),(o,e)=>(r(),s(w,null,[t("div",ee,[e[16]||(e[16]=t("h1",{class:"text-4xl font-bold mb-4 text-black dark:text-white text-center"},"River Ridge 11th Ward Tithing Declaration Sign-up",-1)),t("div",te,[t("div",le,[e[10]||(e[10]=t("label",{for:"date",class:"mb-2 text-black dark:text-white"},"Date:",-1)),c(t("select",{id:"date",class:"border border-gray-300 rounded p-2 text-gray-800","onUpdate:modelValue":e[0]||(e[0]=l=>b(d)?d.value=l:null),onChange:F},[e[9]||(e[9]=t("option",{disabled:"",value:""},"Select a Day",-1)),(r(!0),s(w,null,O(n(P),l=>(r(),s("option",{key:l,value:l},u(J(l)),9,oe))),128))],544),[[M,n(d)]])]),t("div",ne,[e[12]||(e[12]=t("label",{for:"time",class:"mb-2 text-black dark:text-white"},"Time:",-1)),c(t("select",{id:"time",class:"border border-gray-300 rounded p-2 text-gray-800","onUpdate:modelValue":e[1]||(e[1]=l=>b(i)?i.value=l:null),onChange:j,disabled:n(I)},[e[11]||(e[11]=t("option",{disabled:"",value:""},"Select a Time",-1)),(r(!0),s(w,null,O(n(D),l=>(r(),s("option",{key:l,value:l},u(l),9,se))),128))],40,ae),[[M,n(i)]])])]),n(h)?(r(),s("div",re,[t("div",de,[e[13]||(e[13]=t("label",{for:"name",class:"block text-black dark:text-white font-bold mb-2"},"Name:",-1)),c(t("input",{id:"name",type:"text",class:"w-full border border-gray-300 rounded p-2 text-gray-800","onUpdate:modelValue":e[2]||(e[2]=l=>b(y)?y.value=l:null)},null,512),[[g,n(y)]])]),e[15]||(e[15]=t("p",{class:"mb-4 text-sm text-white"},"If you want a reminder, please enter your email",-1)),t("div",ie,[e[14]||(e[14]=t("label",{for:"email",class:"block text-black dark:text-white font-bold mb-2"},"Email",-1)),c(t("input",{id:"email",type:"email",class:"w-full border border-gray-300 rounded p-2 text-gray-800","onUpdate:modelValue":e[3]||(e[3]=l=>b(x)?x.value=l:null)},null,512),[[g,n(x)]])]),t("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-500",onClick:B,disabled:n(H)},"Confirm",8,ue)])):p("",!0),n(A)?(r(),s("div",me,[t("p",null,u(n(V)),1),t("button",{class:"mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",onClick:e[4]||(e[4]=l=>A.value=!1)},"Close")])):p("",!0)]),n(L)?(r(),s("div",ce,[t("div",be,[t("div",ve,[e[17]||(e[17]=t("label",{for:"date-block",class:"mb-2 font-bold"},"Add Date",-1)),c(t("input",{id:"date-block",type:"text",class:"border border-gray-300 rounded p-2","onUpdate:modelValue":e[5]||(e[5]=l=>b(C)?C.value=l:null),placeholder:"2025-08-30"},null,512),[[g,n(C)]])]),t("div",fe,[e[18]||(e[18]=t("label",{for:"time-start",class:"mb-2 font-bold"},"Start Time",-1)),c(t("input",{id:"time-start",type:"text",class:"border border-gray-300 rounded p-2","onUpdate:modelValue":e[6]||(e[6]=l=>b(_)?_.value=l:null),placeholder:"12:00"},null,512),[[g,n(_)]])]),t("div",pe,[e[19]||(e[19]=t("label",{for:"time-end",class:"mb-2 font-bold"},"End Time",-1)),c(t("input",{id:"time-end",type:"text",class:"border border-gray-300 rounded p-2","onUpdate:modelValue":e[7]||(e[7]=l=>b(T)?T.value=l:null),placeholder:"15:00"},null,512),[[g,n(T)]])]),t("button",{class:"ml-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 self-end",onClick:K},"Add")]),t("div",null,[e[22]||(e[22]=t("p",{class:"mt-2 text-lg"},"Upcoming appointments",-1)),(r(!0),s(w,null,O(n(R),l=>(r(),s("div",{key:l.id,class:"border-b border-gray-300 py-2"},[t("div",ye,[t("div",ge,[t("p",he,"ID: "+u(l.id),1),t("p",null,u(l.date_value),1),l.name?(r(),s("p",xe,"Name: "+u(l.name),1)):p("",!0),l.email?(r(),s("p",ke,"Email: "+u(l.email),1)):p("",!0),l.phone?(r(),s("p",we,"Phone: "+u(l.phone),1)):p("",!0)]),t("div",null,[t("button",{class:"ml-4 bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 self-end",onClick:Oe=>Y(l.id)},"Send Reminder",8,Se)])])]))),128)),t("div",Ce,[e[20]||(e[20]=t("p",null,"Email Reminder",-1)),c(t("input",{type:"text",class:"border border-gray-300 rounded p-2",placeholder:"Email Address","onUpdate:modelValue":e[8]||(e[8]=l=>b(m)?m.value=l:null)},null,512),[[g,n(m)]]),t("button",{class:"ml-4 bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 self-end",onClick:q},"Add Email")]),n(k).length>0?(r(),s("div",_e,[e[21]||(e[21]=t("p",{class:"mt-2"},"Known Emails:",-1)),t("ul",Te,[(r(!0),s(w,null,O(n(k),l=>(r(),s("li",{key:l},u(l),1))),128))])])):p("",!0)])])):p("",!0)],64))}});export{Ne as default};
